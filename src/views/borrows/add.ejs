<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js@11.1.0/public/assets/styles/choices.min.css" />
<script src="https://cdn.jsdelivr.net/npm/choices.js@11.1.0/public/assets/scripts/choices.min.js"></script>
<script src="/js/debounce.js"></script>
<script src="/js/useChoice.js"></script>

<div class="max-w-lg mx-auto mt-10 bg-white p-8 rounded-2xl shadow-md">
  <h1 class="text-3xl font-bold mb-6 text-gray-700 flex items-center gap-2">
    üìö Th√™m phi·∫øu m∆∞·ª£n
  </h1>

  <%- include('../error') %>

    <form method="POST" class="space-y-5">
      <!-- Ch·ªçn s√°ch -->
      <div class="flex flex-col gap-2">
        <label for="books" class="text-sm font-medium text-gray-700">
          Danh s√°ch s√°ch m∆∞·ª£n
        </label>
        <select name="books" id="books" multiple required
          class="border border-gray-300 rounded-lg p-2 shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"></select>
        <p class="text-xs text-gray-500 italic">
          (B·∫°n c√≥ th·ªÉ ch·ªçn nhi·ªÅu s√°ch c√πng l√∫c)
        </p>
      </div>

    <!-- Ng√†y m∆∞·ª£n -->
    <div class="flex flex-col gap-2">
      <label for="borrow_date" class="text-sm font-medium text-gray-700">
        Ng√†y m∆∞·ª£n
      </label>
      <input
        type="date"
        name="borrow_date"
        id="borrow_date"
        required
        min="<%= today.toISOString().split('T')[0] %>"
        class="border border-gray-300 rounded-lg p-2 shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
      />
    </div>

    <!-- Ng√†y tr·∫£ -->
    <div class="flex flex-col gap-2">
      <label for="due_date" class="text-sm font-medium text-gray-700">
        Ng√†y tr·∫£ d·ª± ki·∫øn
      </label>
      <input
        type="date"
        name="due_date"
        id="due_date"
        required
        min="<%= today.toISOString().split('T')[0] %>"
        class="border border-gray-300 rounded-lg p-2 shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
      />
    </div>

      <!-- N√∫t h√†nh ƒë·ªông -->
      <div class="flex flex-wrap justify-between items-center gap-3 pt-4">
        <a href="/dashboard/borrow" class="text-gray-600 hover:text-blue-600 hover:underline transition">
          Quay l·∫°i danh s√°ch
        </a>
        <button type="submit"
          class="cursor-pointer bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg font-medium shadow transition">
          üíæ L∆∞u phi·∫øu m∆∞·ª£n
        </button>
      </div>
    </form>
</div>

<script>
  // G·ª£i √Ω s√°ch ƒë·ªông
  useChoice("#books", "/books/search", (data) => {
    return data.data.map((book) => ({
      value: book.id,
      label: book.title,
    }));
  }).then((obj) => {
    const url = new URL(window.location.href);
    const q = url.searchParams.get("q");
    const inputSearchBook = document.querySelector(
      ".choices__input.choices__input--cloned"
    );
    const choiceInner = document.querySelector(".choices__inner");
    if (q && inputSearchBook) {
      inputSearchBook.value = decodeURIComponent(q);
      const event = new CustomEvent("search", {
        detail: {
          value: decodeURIComponent(q),
        },
        bubbles: true,
      });
      obj.element.dispatchEvent(event);
      inputSearchBook.dispatchEvent(new Event("input", { bubbles: true }));
      choiceInner.click();
    }
  });
</script>