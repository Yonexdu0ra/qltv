<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js@11.1.0/public/assets/styles/choices.min.css" />
<script src="https://cdn.jsdelivr.net/npm/choices.js@11.1.0/public/assets/scripts/choices.min.js"></script>
<script src="/js/debounce.js"></script>
<script src="/js/useChoice.js"></script>

<div class="max-w-4xl mx-auto p-6 bg-white rounded-2xl shadow-md mt-6">
  <h1 class="text-3xl font-bold mb-6 text-gray-700 flex items-center gap-2">
    üìö Th√™m s√°ch m·ªõi
  </h1>

  <%- include('../error') %>

    <form enctype="multipart/form-data" method="POST" class="space-y-5">
      <!-- T√™n s√°ch -->
      <div>
        <label for="title" class="block text-sm font-medium text-gray-700 mb-1">T√™n s√°ch</label>
        <input type="text" id="title" name="title" placeholder="Nh·∫≠p t√™n s√°ch..."
          class="block w-full border border-gray-300 rounded-lg shadow-sm p-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
          required />
      </div>

      <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
        <!-- ISBN -->
        <div>
          <label for="isbn" class="block text-sm font-medium text-gray-700 mb-1">ISBN</label>
          <input type="text" id="isbn" name="isbn" placeholder="Nh·∫≠p m√£ ISBN..."
            class="block w-full border border-gray-300 rounded-lg shadow-sm p-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
            required />
        </div>

        <!-- NƒÉm xu·∫•t b·∫£n -->
        <div>
          <label for="published_year" class="block text-sm font-medium text-gray-700 mb-1">NƒÉm xu·∫•t b·∫£n</label>
          <input type="number" id="published_year" name="published_year" placeholder="VD: 2024"
            class="block w-full border border-gray-300 rounded-lg shadow-sm p-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
            required />
        </div>
      </div>

      <!-- T√°c gi·∫£ -->
      <div>
        <label for="authors" class="block text-sm font-medium text-gray-700 mb-1">T√°c gi·∫£</label>
        <select name="authors" id="authors" class="block w-full border border-gray-300 rounded-lg shadow-sm p-2"
          multiple required></select>
      </div>

      <!-- Th·ªÉ lo·∫°i -->
      <div>
        <label for="genres" class="block text-sm font-medium text-gray-700 mb-1">Th·ªÉ lo·∫°i</label>
        <select name="genres" id="genres" class="block w-full border border-gray-300 rounded-lg shadow-sm p-2" multiple
          required></select>
      </div>

      <!-- S·ªë l∆∞·ª£ng -->
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
        <div>
          <label for="quantity_total" class="block text-sm font-medium text-gray-700 mb-1">T·ªïng s·ªë l∆∞·ª£ng</label>
          <input type="number" id="quantity_total" name="quantity_total" placeholder="VD: 20"
            class="block w-full border border-gray-300 rounded-lg shadow-sm p-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
            required />
        </div>

        <div>
          <label for="quantity_available" class="block text-sm font-medium text-gray-700 mb-1">S·ªë l∆∞·ª£ng c√≤n l·∫°i</label>
          <input type="number" id="quantity_available" name="quantity_available" placeholder="VD: 15"
            class="block w-full border border-gray-300 rounded-lg shadow-sm p-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
            required />
        </div>
      </div>

      <!-- M√¥ t·∫£ -->
      <div>
        <label for="description" class="block text-sm font-medium text-gray-700 mb-1">M√¥ t·∫£</label>
        <textarea id="description" name="description" rows="4" placeholder="Nh·∫≠p m√¥ t·∫£ ng·∫Øn g·ªçn v·ªÅ s√°ch..."
          class="block w-full border border-gray-300 rounded-lg shadow-sm p-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"></textarea>
      </div>

      <!-- ·∫¢nh b√¨a -->
      <div>
        <label for="image_cover" class="block text-sm font-medium text-gray-700 mb-1">·∫¢nh b√¨a</label>
        <input type="file" id="image_cover" name="image_cover" accept="image/*"
          class="block w-full border border-gray-300 rounded-lg shadow-sm p-2 file:mr-3 file:py-1 file:px-3 file:rounded-md file:border-0 file:text-sm file:font-medium file:bg-blue-600 file:text-white hover:file:bg-blue-700"
          required />
        <div id="show_image_cover" class="mt-3"></div>
      </div>

      <!-- N√∫t -->
      <div class="flex flex-wrap items-center gap-3 mt-6">
        <button type="submit"
          class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg font-medium shadow transition">
          üíæ L∆∞u s√°ch
        </button>
        <a href="/books" class="text-gray-600 hover:text-blue-600 hover:underline transition">‚Üê Quay l·∫°i danh s√°ch</a>
      </div>
    </form>
</div>

<script>
  // Hi·ªÉn th·ªã ·∫£nh xem tr∆∞·ªõc
  const image_cover = document.getElementById("image_cover");
  const show_image_cover = document.getElementById("show_image_cover");
  image_cover.addEventListener("change", function () {
    const file = this.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = function (event) {
        show_image_cover.innerHTML = `
          <img src="${event.target.result}" alt="·∫¢nh b√¨a"
            class="mt-2 max-h-56 rounded-lg shadow-md border border-gray-200 object-contain">
        `;
      };
      reader.readAsDataURL(file);
    } else {
      show_image_cover.innerHTML = "";
    }
  });

  // Kh·ªüi t·∫°o Choices.js v·ªõi d·ªØ li·ªáu ƒë·ªông
  useChoice("#authors", "/authors/search", (data) => {
    return data.data.map((author) => ({
      value: author.id,
      label: author.name,
    }));
  });
  useChoice("#genres", "/genres/search", (data) => {
    return data.data.map((genre) => ({
      value: genre.id,
      label: genre.name,
    }));
  });
</script>