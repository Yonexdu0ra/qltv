<div class="flex flex-col gap-4 relative">
  <h2 class="text-2xl font-bold text-gray-700">Quản lý sách</h2>
  <%- include('../errorMessageWithQuery') %> <%-
  include('../successMessageWithQuery') %>
  <a href="/books/add" class="text-blue-600 hover:underline">Thêm sách</a>
  <div class="flex flex-col gap-4">
    <div class="flex flex-col sm:flex-row flex-wrap justify-center gap-2">
      <input
        name="search"
        type="text"
        placeholder="Tìm kiếm sách"
        class="flex-1 border rounded px-3 py-2 max-w-md"
      />
      <select
        class="flex-1 border rounded px-3 py-2 max-w-md"
        name="sort"
        id="sort"
      >
        <option value="">Sắp xếp theo tên A-Z</option>
        <option value="">Sắp xếp theo tên Z-A</option>
        <option value="">Mới nhất</option>
        <option value="">Cũ nhất</option>
      </select>
      <button class="bg-blue-600 w-25 text-white px-4 py-2 rounded">
        Tìm kiếm
      </button>
    </div>
  </div>
  <div class="overflow-x-auto relative">
    <table
      class="min-w-full bg-white border rounded border-gray-200 relative z-0"
    >
      <thead class="sticky top-0 bg-gray-50 z-10">
        <tr>
          <th
            class="px-6 py-3 border-b border-gray-200 text-left text-sm font-semibold text-gray-600"
          >
            #
          </th>
          <th
            class="px-6 py-3 border-b border-gray-200 text-left text-sm font-semibold text-gray-600"
          >
            Ảnh
          </th>
          <th
            class="px-6 py-3 border-b border-gray-200 text-left text-sm font-semibold text-gray-600"
          >
            Tên sách
          </th>
          <th
            class="px-6 py-3 border-b border-gray-200 text-left text-sm font-semibold text-gray-600"
          >
            ISBN
          </th>
          <th
            class="px-6 py-3 border-b border-gray-200 text-left text-sm font-semibold text-gray-600"
          >
            Năm xuất bản
          </th>
          <th
            class="px-6 py-3 border-b border-gray-200 text-left text-sm font-semibold text-gray-600"
          >
            Số lượng
          </th>
          <th
            class="px-6 py-3 border-b border-gray-200 bg-gray-50 text-left text-sm font-semibold text-gray-600"
          >
            Hành động
          </th>
        </tr>
      </thead>
      <tbody class="relative z-0">
        <% books.forEach((book, index) => { %>
        <tr class="hover:bg-gray-100 relative">
          <td class="px-6 py-4 border-b border-gray-200 text-sm text-gray-700">
            <%= ++index %>
          </td>
          <td class="px-6 py-4 border-b border-gray-200 text-sm text-gray-700">
            <img
              src="<%= book.image_cover %>"
              alt="<%= book.title %>"
              class="w-12 h-12 object-cover rounded"
            />
          </td>
          <td class="px-6 py-4 border-b border-gray-200 text-sm text-gray-700">
            <%= book.title %>
          </td>
          <td class="px-6 py-4 border-b border-gray-200 text-sm text-gray-700">
            <%= book.isbn %>
          </td>
          <td class="px-6 py-4 border-b border-gray-200 text-sm text-gray-700">
            <%= book.published_year %>
          </td>
          <td class="px-6 py-4 border-b border-gray-200 text-sm text-gray-700">
            <%= book.quantity_available %> / <%= book.quantity_total %>
          </td>
          <td
            class="px-6 py-4 border-b border-gray-200 text-sm text-gray-700 relative"
          >
            <button
              type="button"
              onclick="toggleMenu(<%= book.id %>)"
              class="p-2 rounded hover:bg-gray-200 transition"
            >
              tùy chọn
            </button>
            <div
              id="menu-<%= book.id %>"
              class="hidden absolute top-0 right-0 transform -translate- -translate-x-1/2 bg-white border rounded shadow-lg p-2 z-50 min-w-[100px]"
            >
              <a
                href="/books/edit/<%= book.id %>"
                class="text-blue-600 hover:underline block mb-1"
                >Sửa</a
              >
              <a
                href="/books/delete/<%= book.id %>"
                class="text-red-600 hover:underline block"
                >Xóa</a
              >
              <a
                href="/books/detail/<%= book.id %>"
                class="text-green-600 hover:underline block"
                >Chi tiết</a
              >
            </div>
          </td>
        </tr>
        <% }) %>
      </tbody>
    </table>
</div>
<div class="flex justify-center gap-4 items-center mt-4">
  <button class="p-2 bg-blue-500 rounded text-white">Trang trước</button>
  <p><span>1</span> / <span>1</span></p>
  <button class="p-2 bg-blue-500 rounded text-white">Trang sau</button>
</div>
</div>

<script>
  function toggleMenu(id) {
    // Ẩn tất cả menu khác
    document.querySelectorAll('[id^="menu-"]').forEach((m) => {
      if (m.id !== "menu-" + id) m.classList.add("hidden");
    });
    // Hiện / ẩn menu được chọn
    const menu = document.getElementById("menu-" + id);
    menu.classList.toggle("hidden");
  }

  // Ẩn menu khi click ra ngoài
  document.addEventListener("click", (e) => {
    if (!e.target.closest("td")) {
      document
        .querySelectorAll('[id^="menu-"]')
        .forEach((m) => m.classList.add("hidden"));
    }
  });
</script>
