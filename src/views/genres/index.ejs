<div class="flex flex-col gap-4 relative">
  <h2 class="text-2xl font-bold text-gray-700">Quản lý thể loại</h2>
  <%- include('../errorMessageWithQuery') %>
  <%- include('../successMessageWithQuery') %>
  <a href="/genre/add" class="text-blue-600 hover:underline ">Thêm thể loại</a>
  <div class="flex flex-col gap-4">
    <div class="flex flex-col sm:flex-row flex-wrap justify-center gap-2">
      <input name="search" type="text" placeholder="Tìm kiếm thể loại" class="flex-1 border rounded px-3 py-2 max-w-md" />
      <select class="flex-1 border rounded px-3 py-2 max-w-md" name="sort" id="sort">
        <option  value="">Sắp xếp theo tên A-Z</option>
        <option value="">Sắp xếp theo tên Z-A</option>
        <option value="">Mới nhất</option>
        <option value="">Cũ nhất</option>
      </select>
      <button class="bg-blue-600 w-25 text-white px-4 py-2 rounded">Tìm kiếm</button>
    </div>
  </div>
  <div class="overflow-x-auto relative">
    <table class="min-w-full bg-white border rounded border-gray-200 relative z-0">
      <thead class="sticky top-0 bg-gray-50 z-10">
        <tr>
          <th class="px-6 py-3 border-b border-gray-200 text-left text-sm font-semibold text-gray-600">#</th>
          <th class="px-6 py-3 border-b border-gray-200 text-left text-sm font-semibold text-gray-600">Tên thể loại</th>
          <th class="px-6 py-3 border-b border-gray-200 bg-gray-50 text-left text-sm font-semibold text-gray-600">
            Hành động
          </th>
        </tr>
      </thead>
      <tbody class="relative z-0">
        <% genres.forEach((genre, index) => { %>
        <tr class="hover:bg-gray-100 relative">
          <td class="px-6 py-4 border-b border-gray-200 text-sm text-gray-700"><%= ++index %></td>
          <td class="px-6 py-4 border-b border-gray-200 text-sm text-gray-700"><%= genre.name %></td>
          <td class="px-6 py-4 border-b border-gray-200 text-sm text-gray-700 relative">
            <button 
              type="button"
              onclick="toggleMenu(<%= genre.id %>)"
              class="p-2 rounded hover:bg-gray-200 transition"
            >
              tùy chọn
            </button>
            <div 
              id="menu-<%= genre.id %>"
              class="hidden absolute  top-0 right-0 transform -translate- -translate-x-1/2 bg-white border rounded shadow-lg p-2 z-50 min-w-[100px]"
            >
              <a href="/genre/edit/<%= genre.id %>" class="text-blue-600 hover:underline block mb-1">Sửa</a>
              <a href="/genre/delete/<%= genre.id %>" class="text-red-600 hover:underline block">Xóa</a>
              <a href="/genre/detail/<%= genre.id %>" class="text-green-600 hover:underline block">Chi tiết</a>
            </div>
          </td>
        </tr>
        <% }) %>
      </tbody>
    </table>
    <div class="flex justify-center gap-4 items-center mt-4">
      <button class="p-2 bg-blue-500 rounded text-white">Trang trước</button>
      <p>
        <span>1</span> / <span>1</span>
      </p>
      <button class="p-2 bg-blue-500 rounded text-white">Trang sau</button>
    </div>
  </div>
</div>

<script>
  function toggleMenu(id) {
    // Ẩn tất cả menu khác
    document.querySelectorAll('[id^="menu-"]').forEach(m => {
      if (m.id !== 'menu-' + id) m.classList.add('hidden');
    });
    // Hiện / ẩn menu được chọn
    const menu = document.getElementById('menu-' + id);
    menu.classList.toggle('hidden');
  }

  // Ẩn menu khi click ra ngoài
  document.addEventListener('click', (e) => {
    if (!e.target.closest('td')) {
      document.querySelectorAll('[id^="menu-"]').forEach(m => m.classList.add('hidden'));
    }
  });
</script>
